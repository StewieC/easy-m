{% extends 'contributions/base.html' %}
{% block title %}{{ group.name }} - easy-m{% endblock %}
{% block content %}
<main class="container mx-auto px-4 py-8">
    <section class="glassmorphism p-6 rounded-lg shadow-lg mb-8">
        <h2 class="text-2xl font-semibold mb-4 text-white">{{ group.name }}</h2>
        <p class="text-md mb-2 text-gray-300">Type: {{ group.group_type }}</p>
        <p class="text-md mb-2 text-gray-300">Admin: {{ group.admin.username }}</p>
        <p class="text-md mb-4 text-gray-300">Total Contributions: KSH {{ group.total_contributions }}</p>

        {% if group.group_type == 'merry_go_round' %}
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-2 text-white">Last Payout</h3>
            {% if last_payout %}
            <p class="text-md text-gray-300">Payout of {{ last_payout.amount }} KSH to {{ last_payout.recipient.username }} on {{ last_payout.date }}</p>
            {% else %}
            <p class="text-gray-400">No payouts yet.</p>
            {% endif %}
        </div>

        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-2 text-white">Next Payout</h3>
            {% if next_payout %}
            <p class="text-md text-gray-300">Next payout of {{ next_payout.amount }} KSH to {{ next_payout.recipient.username }}.</p>
            {% else %}
            <p class="text-gray-400">No upcoming payouts scheduled.</p>
            {% endif %}
        </div>

        {% if user == group.admin %}
        <form method="post">
            {% csrf_token %}
            <button type="submit" name="make_payout" class="button-gradient hover:bg-FFC107 text-white font-bold py-2 px-4 rounded-full transition duration-300 ease-in-out">Make Payout</button>
        </form>
        {% endif %}
        {% endif %}

        <div class="mt-6">
            <h3 class="text-lg font-semibold mb-2 text-white">Contribution History</h3>
            {% if contributions %}
            <table class="w-full text-left">
                <thead>
                    <tr class="border-b">
                        <th class="py-3 px-4 text-white">Member</th>
                        <th class="py-3 px-4 text-white">Amount</th>
                        <th class="py-3 px-4 text-white">Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for contribution in contributions %}
                    <tr class="border-b">
                        <td class="py-3 px-4 text-gray-300">{{ contribution.user.username }}</td>
                        <td class="py-3 px-4 text-gray-300">{{ contribution.amount }} KSH</td>
                        <td class="py-3 px-4 text-gray-300">{{ contribution.date|date:"D, d M Y" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-gray-400">No contributions have been made yet.</p>
            {% endif %}
        </div>

        <div class="mt-6">
            <h3 class="text-lg font-semibold mb-2 text-white">Make a Contribution</h3>
            <form method="post" class="space-y-4">
                {% csrf_token %}
                <div class="flex space-x-2">
                    {{ form.amount }}
                    <button type="submit" name="contribute" class="button-gradient hover:bg-FFC107 text-white font-bold py-2 px-4 rounded-full transition duration-300 ease-in-out">Contribute</button>
                </div>
                {% if form.errors %}
                <div class="text-red-400">
                    {% for error in form.non_field_errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
                {% endif %}
            </form>
        </div>

        <div class="mt-6">
            <h3 class="text-lg font-semibold mb-2 text-white">Members</h3>
            <ul class="space-y-2">
                {% for member in group.members.all %}
                <li class="glassmorphism p-2 flex justify-between items-center">
                    <span class="text-white">{{ member.username }}</span>
                    {% if user == group.admin and member != group.admin %}
                    <form method="post" class="inline">
                        {% csrf_token %}
                        <input type="hidden" name="user_id" value="{{ member.id }}">
                        <button type="submit" name="remove_user" class="text-red-400 hover:text-red-300 transition duration-300">Remove</button>
                    </form>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </div>

        {% if user == group.admin %}
        <div class="mt-6">
            <h3 class="text-lg font-semibold mb-2 text-white">Add Member</h3>
            <form method="post" class="flex space-x-2">
                {% csrf_token %}
                <input type="email" name="email" placeholder="Enter email" class="flex-1 p-2 rounded-lg" required>
                <button type="submit" name="add_user" class="button-gradient hover:bg-FFC107 text-white font-bold py-2 px-4 rounded-full transition duration-300 ease-in-out">Add</button>
            </form>
        </div>
        {% endif %}
    </section>
</main>
{% endblock %}